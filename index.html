<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StreamFlix - Streaming Service</title>
    <!-- Version: 2023-04-04 Telegram Mini App Fix v3 -->
    
    <!-- Simple Bootstrap for Telegram Mini App -->
    <script>
        // Immediate execution to set up Telegram Mini App
        (function() {
            console.log('BOOTSTRAP: Starting Mini App initialization');
            
            // Create a visible status indicator
            function createStatusIndicator() {
                var statusDiv = document.createElement('div');
                statusDiv.id = 'tg-status';
                statusDiv.style.position = 'fixed';
                statusDiv.style.bottom = '10px';
                statusDiv.style.right = '10px';
                statusDiv.style.backgroundColor = 'rgba(0,0,0,0.7)';
                statusDiv.style.color = 'white';
                statusDiv.style.padding = '10px';
                statusDiv.style.borderRadius = '5px';
                statusDiv.style.fontSize = '12px';
                statusDiv.style.zIndex = '9999';
                statusDiv.style.maxWidth = '80%';
                statusDiv.style.maxHeight = '200px';
                statusDiv.style.overflow = 'auto';
                statusDiv.innerHTML = 'Initializing...';
                
                // Add to body or create body if it doesn't exist
                if (document.body) {
                    document.body.appendChild(statusDiv);
                } else {
                    document.addEventListener('DOMContentLoaded', function() {
                        document.body.appendChild(statusDiv);
                    });
                }
                
                return statusDiv;
            }
            
            // Create status indicator immediately
            var statusDiv = createStatusIndicator();
            
            // Log status to indicator
            function logStatus(message) {
                console.log('BOOTSTRAP: ' + message);
                if (statusDiv) {
                    statusDiv.innerHTML += '<br>' + message;
                    statusDiv.scrollTop = statusDiv.scrollHeight;
                }
            }
            
            // Log error to indicator
            function logError(message) {
                console.error('BOOTSTRAP ERROR: ' + message);
                if (statusDiv) {
                    statusDiv.innerHTML += '<br><span style="color:red">ERROR: ' + message + '</span>';
                    statusDiv.scrollTop = statusDiv.scrollHeight;
                }
            }
            
            // Check if Telegram WebApp is available
            if (window.Telegram && window.Telegram.WebApp) {
                logStatus('Telegram WebApp detected');
                
                // Set up WebApp ready
                try {
                    window.Telegram.WebApp.ready();
                    logStatus('WebApp.ready() called');
                    
                    window.Telegram.WebApp.expand();
                    logStatus('WebApp.expand() called');
                } catch (e) {
                    logError('Failed to initialize WebApp: ' + e.message);
                }
            } else {
                logStatus('Telegram WebApp not detected, running in browser mode');
            }
            
            // Set up global error handler
            window.onerror = function(message, source, lineno, colno, error) {
                logError(message + ' at ' + source + ':' + lineno);
                return false;
            };
            
            logStatus('Bootstrap completed');
        })();
    </script>
    
    <!-- Debugging script to track initialization -->
    <script>
        console.log('DEBUG: HTML loading started');
        
        // Global error handler
        window.onerror = function(message, source, lineno, colno, error) {
            console.error('Global error:', message, 'at', source, lineno, colno);
            console.error('Error stack:', error?.stack);
            
            // Create visible error message for debugging in Telegram
            const errorDiv = document.createElement('div');
            errorDiv.style.position = 'fixed';
            errorDiv.style.top = '0';
            errorDiv.style.left = '0';
            errorDiv.style.backgroundColor = 'red';
            errorDiv.style.color = 'white';
            errorDiv.style.padding = '10px';
            errorDiv.style.zIndex = '9999';
            errorDiv.style.width = '100%';
            errorDiv.style.maxHeight = '200px';
            errorDiv.style.overflow = 'auto';
            errorDiv.textContent = `Error: ${message} at ${source}:${lineno}:${colno}`;
            document.body.appendChild(errorDiv);
            
            return false;
        };
    </script>
    
    <!-- GitHub Pages SPA redirect script -->
    <script type="text/javascript">
      // Single Page Apps for GitHub Pages
      // MIT License https://github.com/rafgraph/spa-github-pages
      // This script checks to see if a redirect is present in the query string,
      // converts it back into the correct url and adds it to the
      // browser's history using window.history.replaceState(...),
      // which won't cause the browser to attempt to load the new url.
      (function(l) {
        if (l.search[1] === '/' ) {
          var decoded = l.search.slice(1).split('&').map(function(s) { 
            return s.replace(/~and~/g, '&')
          }).join('?');
          window.history.replaceState(null, null,
              l.pathname.slice(0, -1) + decoded + l.hash
          );
        }
      }(window.location))
    </script>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>console.log('DEBUG: Before loading config.js');</script>
    <!-- CRITICAL: LOAD IN CORRECT ORDER - Load configuration first -->
    <script src="js/config.js"></script>
    <script>console.log('DEBUG: After loading config.js');</script>
    
    <script>console.log('DEBUG: Before loading Telegram Web App SDK');</script>
    <!-- Telegram Web App SDK - we're already loading it in the bootstrap, but include again for completeness -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        console.log('DEBUG: After loading Telegram Web App SDK');
        console.log('DEBUG: window.Telegram exists?', !!window.Telegram);
        console.log('DEBUG: window.Telegram.WebApp exists?', !!(window.Telegram && window.Telegram.WebApp));
    </script>
    
    <script>console.log('DEBUG: Before loading router.js');</script>
    <!-- CRITICAL: LOAD IN CORRECT ORDER - App components -->
    <script src="js/router.js"></script>
    <script>console.log('DEBUG: After loading router.js');</script>
    
    <script>console.log('DEBUG: Before loading telegram-app.js');</script>
    <script src="js/telegram-app.js"></script>
    <script>console.log('DEBUG: After loading telegram-app.js');</script>
    
    <script>console.log('DEBUG: Before loading api-service.js');</script>
    <script src="js/api-service.js"></script>
    <script>console.log('DEBUG: After loading api-service.js');</script>
    
    <script>console.log('DEBUG: Before loading main.js');</script>
    <script src="js/main.js"></script>
    <script>console.log('DEBUG: After loading main.js, all scripts loaded');</script>
</head>
<body>
    <!-- Debug status display -->
    <div id="debug-status" style="position: fixed; bottom: 10px; right: 10px; background: rgba(0,0,0,0.7); color: white; padding: 10px; border-radius: 5px; font-size: 10px; z-index: 9999; max-width: 300px; max-height: 200px; overflow: auto; display: none;">
        Initialization logs will appear here
    </div>
    <script>
        // Show debug in Telegram
        setTimeout(function() {
            const debugStatus = document.getElementById('debug-status');
            if (debugStatus) {
                debugStatus.style.display = 'block';
                debugStatus.innerHTML = 'DEBUG: App initialization started<br>' + 
                    'URL: ' + window.location.href + '<br>' +
                    'Telegram SDK: ' + (window.Telegram ? 'Loaded' : 'Not loaded') + '<br>' +
                    'WebApp ready: ' + (window.Telegram?.WebApp ? 'Yes' : 'No');
            }
        }, 500);
    </script>
    
    <div class="app-container">
    <!-- Search Bar -->
    <div class="search-bar">
            <div class="search-field">
            <i class="fas fa-search"></i>
                <input type="text" placeholder="Search movies..." id="search-input">
                <i class="fas fa-microphone"></i>
        </div>
    </div>
        
        <!-- Hero Card (Featured Content) -->
        <div class="hero-card">
            <div class="featured-card" id="featured-movie">
                <div class="badge">Featured</div>
                <div class="likes" id="featured-like">
                    <i class="fas fa-thumbs-up"></i>
                    <span>1.5K</span>
                </div>
                <img src="https://archive.org/services/img/earth-vs-the-flying-saucers-color" alt="Featured Movie">
                <div class="title-container">
                    <h2>Earth vs the Flying Saucers</h2>
                </div>
            </div>
        </div>
        
        <!-- Category Container -->
        <div id="category-container">
            <!-- Test Video Section - Guaranteed to work -->
            <div class="section">
                <div class="section-header">
                    <h3>Test Video Player</h3>
                    <span class="subtitle" style="font-size: 0.8rem; color: #ccc; margin-left: 10px;">Guaranteed to work</span>
                </div>
                <div class="content-row" id="test-video-row">
                    <div class="content-card" id="test-video-card" style="min-width: 300px;">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/c5/Big_buck_bunny_poster_big.jpg/800px-Big_buck_bunny_poster_big.jpg" alt="Big Buck Bunny">
                        <div class="card-info">
                            <p>Big Buck Bunny (Test Video)</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- New Releases Section -->
            <div class="section">
                <div class="section-header">
                    <h3>New Releases</h3>
                    <span class="see-all">See All</span>
                </div>
                <div class="content-row" id="new-releases-row">
                    <!-- Content will be loaded dynamically -->
                    <div class="loading-spinner">Loading...</div>
                </div>
            </div>

            <!-- Popular Movies Section -->
            <div class="section">
                <div class="section-header">
                    <h3>Popular Movies</h3>
                    <span class="see-all">See All</span>
                </div>
                <div class="content-row" id="popular-movies-row">
                    <!-- Content will be loaded dynamically -->
                    <div class="loading-spinner">Loading...</div>
                </div>
            </div>

            <!-- Public Domain Classics -->
            <div class="section">
                <div class="section-header">
                    <h3>Public Domain Classics</h3>
                    <span class="see-all">See All</span>
                </div>
                <div class="content-row" id="classics-row">
                    <!-- Content will be loaded dynamically -->
                    <div class="loading-spinner">Loading...</div>
                </div>
            </div>
            
            <!-- Action Movies -->
            <div class="section">
                <div class="section-header">
                    <h3>Action Movies</h3>
                    <span class="see-all">See All</span>
                </div>
                <div class="content-row" id="action-row">
                    <!-- Content will be loaded dynamically -->
                    <div class="loading-spinner">Loading...</div>
                </div>
            </div>
            
            <!-- Sci-Fi -->
            <div class="section">
                <div class="section-header">
                    <h3>Sci-Fi</h3>
                    <span class="see-all">See All</span>
                </div>
                <div class="content-row" id="scifi-row">
                    <!-- Content will be loaded dynamically -->
                    <div class="loading-spinner">Loading...</div>
                </div>
            </div>
            
            <!-- Drama -->
            <div class="section">
                <div class="section-header">
                    <h3>Drama</h3>
                    <span class="see-all">See All</span>
                </div>
                <div class="content-row" id="drama-row">
                    <!-- Content will be loaded dynamically -->
                    <div class="loading-spinner">Loading...</div>
                </div>
            </div>
            
            <!-- Comedy -->
            <div class="section">
                <div class="section-header">
                    <h3>Comedy</h3>
                    <span class="see-all">See All</span>
                </div>
                <div class="content-row" id="comedy-row">
                    <!-- Content will be loaded dynamically -->
                    <div class="loading-spinner">Loading...</div>
                </div>
            </div>
            
            <!-- Horror -->
            <div class="section">
                <div class="section-header">
                    <h3>Horror</h3>
                    <span class="see-all">See All</span>
                </div>
                <div class="content-row" id="horror-row">
                    <!-- Content will be loaded dynamically -->
                    <div class="loading-spinner">Loading...</div>
                </div>
            </div>
            
            <!-- Documentary -->
            <div class="section">
                <div class="section-header">
                    <h3>Documentary</h3>
                    <span class="see-all">See All</span>
                </div>
                <div class="content-row" id="documentary-row">
                    <!-- Content will be loaded dynamically -->
                    <div class="loading-spinner">Loading...</div>
                </div>
            </div>
            
            <!-- Animation -->
            <div class="section">
                <div class="section-header">
                    <h3>Animation</h3>
                    <span class="see-all">See All</span>
                </div>
                <div class="content-row" id="animation-row">
                    <!-- Content will be loaded dynamically -->
                    <div class="loading-spinner">Loading...</div>
                </div>
            </div>
            
            <!-- Family -->
            <div class="section">
                <div class="section-header">
                    <h3>Family</h3>
                    <span class="see-all">See All</span>
                </div>
                <div class="content-row" id="family-row">
                    <!-- Content will be loaded dynamically -->
                    <div class="loading-spinner">Loading...</div>
                </div>
            </div>

            <!-- Mystery -->
            <div class="section">
                <div class="section-header">
                    <h3>Mystery</h3>
                    <span class="see-all">See All</span>
                </div>
                <div class="content-row" id="mystery-row">
                    <!-- Content will be loaded dynamically -->
                    <div class="loading-spinner">Loading...</div>
                </div>
            </div>
            
            <!-- Thriller -->
            <div class="section">
                <div class="section-header">
                    <h3>Thriller</h3>
                    <span class="see-all">See All</span>
                </div>
                <div class="content-row" id="thriller-row">
                    <!-- Content will be loaded dynamically -->
                    <div class="loading-spinner">Loading...</div>
                </div>
            </div>
            
            <!-- Romance -->
            <div class="section">
                <div class="section-header">
                    <h3>Romance</h3>
                    <span class="see-all">See All</span>
                </div>
                <div class="content-row" id="romance-row">
                    <!-- Content will be loaded dynamically -->
                    <div class="loading-spinner">Loading...</div>
                </div>
            </div>
            
            <!-- Western -->
            <div class="section">
                <div class="section-header">
                    <h3>Western</h3>
                    <span class="see-all">See All</span>
                </div>
                <div class="content-row" id="western-row">
                    <!-- Content will be loaded dynamically -->
                    <div class="loading-spinner">Loading...</div>
                </div>
            </div>
            
            <!-- War -->
            <div class="section">
                <div class="section-header">
                    <h3>War</h3>
                    <span class="see-all">See All</span>
                </div>
                <div class="content-row" id="war-row">
                    <!-- Content will be loaded dynamically -->
                    <div class="loading-spinner">Loading...</div>
                </div>
            </div>
            
            <!-- Fantasy -->
            <div class="section">
                <div class="section-header">
                    <h3>Fantasy</h3>
                    <span class="see-all">See All</span>
                </div>
                <div class="content-row" id="fantasy-row">
                    <!-- Content will be loaded dynamically -->
                    <div class="loading-spinner">Loading...</div>
                </div>
            </div>
            
            <!-- Crime -->
            <div class="section">
                <div class="section-header">
                    <h3>Crime</h3>
                    <span class="see-all">See All</span>
                </div>
                <div class="content-row" id="crime-row">
                    <!-- Content will be loaded dynamically -->
                    <div class="loading-spinner">Loading...</div>
                </div>
            </div>
            
            <!-- Adventure -->
            <div class="section">
                <div class="section-header">
                    <h3>Adventure</h3>
                    <span class="see-all">See All</span>
                </div>
                <div class="content-row" id="adventure-row">
                    <!-- Content will be loaded dynamically -->
                    <div class="loading-spinner">Loading...</div>
                </div>
            </div>
            
            <!-- Biography -->
            <div class="section">
                <div class="section-header">
                    <h3>Biography</h3>
                    <span class="see-all">See All</span>
                </div>
                <div class="content-row" id="biography-row">
                    <!-- Content will be loaded dynamically -->
                    <div class="loading-spinner">Loading...</div>
                </div>
            </div>
            
            <!-- History -->
            <div class="section">
                <div class="section-header">
                    <h3>History</h3>
                    <span class="see-all">See All</span>
                </div>
                <div class="content-row" id="history-row">
                    <!-- Content will be loaded dynamically -->
                    <div class="loading-spinner">Loading...</div>
                </div>
            </div>
            
            <!-- Music -->
            <div class="section">
                <div class="section-header">
                    <h3>Music</h3>
                    <span class="see-all">See All</span>
                </div>
                <div class="content-row" id="music-row">
                    <!-- Content will be loaded dynamically -->
                    <div class="loading-spinner">Loading...</div>
                </div>
            </div>
            
            <!-- Sport -->
            <div class="section">
                <div class="section-header">
                    <h3>Sport</h3>
                    <span class="see-all">See All</span>
                </div>
                <div class="content-row" id="sport-row">
                    <!-- Content will be loaded dynamically -->
                    <div class="loading-spinner">Loading...</div>
                </div>
            </div>
            
            <!-- Short Films -->
            <div class="section">
                <div class="section-header">
                    <h3>Short Films</h3>
                    <span class="see-all">See All</span>
                </div>
                <div class="content-row" id="short-films-row">
                    <!-- Content will be loaded dynamically -->
                    <div class="loading-spinner">Loading...</div>
                </div>
            </div>
            
            <!-- Foreign -->
            <div class="section">
                <div class="section-header">
                    <h3>Foreign</h3>
                    <span class="see-all">See All</span>
                </div>
                <div class="content-row" id="foreign-row">
                    <!-- Content will be loaded dynamically -->
                    <div class="loading-spinner">Loading...</div>
                </div>
            </div>
        </div>
        
        <!-- Navigation Bar -->
        <div class="nav-bar">
            <div class="nav-item active">
                <a href="index.html">
                    <i class="fas fa-home"></i>
                    <p>Home</p>
                </a>
            </div>
            <div class="nav-item">
                <a href="pages/activity.html">
                    <i class="fas fa-chart-line"></i>
                    <p>Activity</p>
                </a>
            </div>
            <div class="nav-item">
                <a href="pages/account.html">
                    <i class="fas fa-user"></i>
                    <p>Account</p>
                </a>
            </div>
        </div>
    </div>

    <!-- IMPORTANT: NO INLINE SCRIPTS HERE -->
</body>
</html>